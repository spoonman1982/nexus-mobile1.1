<!DOCTYPE html>

<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Poll Form</title>
		<meta name="author" content="James" />
		<!-- Date: 2014-08-07 -->
			<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="themes/css/base.css" />
		<link rel="stylesheet" href="themes/nexus1.1.css" />
  		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.3/jquery.mobile.structure-1.4.3.css" />
		<script src="themes/jquery-1.11.1.js"></script>
		<script src="themes/jquery.mobile-1.4.3.js"></script>
	

	</head>
	<body>
		<div data-role="page" id="poll_form" data-theme="a">	
			<div data-role="header" data-position="inline">
				<a href="#myPanel_2" data-icon="bars" data-iconpos="notext"></a>
					<h1>Poll Form</h1>
				<a href="index.html" data-icon="home" data-iconpos="notext"></a>
			</div>
			<div data-role="content" data-theme="a">
				
				<form action="" id="posting_form" method="">
					
					<div data-role="fieldcontain" >
						    <label for="title">Title</label>
						    <input type="text" name="title" id="title" value="">
					</div>
					<div data-role="fieldcontain" >
						    <label for="body">Body</label>
						    <input type="text" name="body" id="body" value="">
					</div>
					<div data-role="fieldcontain" >
						    <label for="pub_date">Publised On</label>
						    <input type="datetime" name="pub_date" id="pub_date" value="" placeholder="2013-01-27 19:01:37">
					</div>
					<div data-role="fieldcontain" >
							<input type="submit" value="submit">
					</div>
					
				</form>
				
			</div>		
			<div data-role="footer" data-id="foo2" data-position="fixed">		
				<div data-role="navbar">
					<ul>
						<li><a href="#" class="ui-btn-active  ui-state-persist">Poll Form</a></li>
						<li><a href="poll_list.html" data-transition="slide">Poll List</a></li>
					</ul>
				</div><!-- /navbar -->	
			</div><!-- /footer -->
			<div data-role="panel" id="myPanel_2" data-display="overlay" >
				<ul data-role="listview">
				 	<li><a href="#">Poll Form</a></li>
				 	<li><a href="history.html">History</a></li>
				 	<li><a href="smart_home.html">Smart Home</a></li>
				 	<li><a href="settings.html">Settings</a></li>
				 	<li><a href="log_out.html">Log Out</a></li>
				 </ul>
			</div><!-- /end of panel -->		
		<script>
		

  	/* $("#posting_form").submit(function () {
				$.ajax({
		        url: "http://localhost:8000/api/v1/poll/",
		        type: "POST",
  				dataType: "json",
  				processData:  false,
  				contentType: "application/json",
		        data: $("form#posting_form").serialize(),
		        success: function( response ) {
           			$.mobile.changePage( 'poll_list.html', {data: {"title": response.title}} );
        			}
		    	});
		            return false;
		});		*/

	    

			$("#posting_form").submit(function(event) {


				var $form = $(this);

				var f_title = $form.find("input[name='title']").val();
				var f_body = $form.find("input[name='body']").val();
				var f_pub_date = $form.find("input[name='pub_date']").val();

				var f_data = JSON.stringify({
					"body": f_body,
					"pub_date": f_pub_date,
					"title": f_title,
				});

			$.ajax({
		        url: "http://localhost:8000/api/v1/poll/",
		        type: "POST",
  				dataType: "json",
  				processData:  false,
  				contentType: "application/json",
		        data: f_data,
		        success: function( response ) {
           			$.mobile.changePage( 'poll_list.html', {data: {"title": response.title}} );
        			}
		    });
		            return false;
		            
			$.mobile.changePage('poll_list.html', {
		   		transition: 'slide',
		   		reverse: false,
		  	});
		//window.location.replace("index.html");
	});
	
	$('#poll_form').on('swipeleft swiperight', function (event) {
		
		 if(event.type == 'swiperight') {
				$('#myPanel_2').panel('open');
		 }
		
		 if(event.type == 'swipeleft') {
		  $.mobile.changePage('poll_list.html', {
		   transition: 'slide',
		   reverse: false
		  });
		 }
	});
			</script>
					
		</div><!-- /end of page -->
	</body>
</html>
